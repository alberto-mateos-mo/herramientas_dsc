# Conocimientos básicos de R

## Buscando ayuda

Por sí mismo, R cuenta con funciones que nos permmitirán obtener ayuda sobre R en general pero también sobre las diferentes funciones que estemos usando para resolver algún problema.

Para mostrar un manual de ayuda general en formato HTML corremos el siguiente código en la consola:

```{r, eval=FALSE}
help.start()
```

El manual será mostrado en el panel de ayuda dentro de RStudio pero puede abrirse con el navegador en caso de que así lo deseemos.

Supongamos ahora que dentro de nuestro flujo de trabajo estamos utilizando la funcíón `log()` sin embargo no estamos familiarizados con ella y deseamos obtener ayuda sobre el uso de la función. 

Para a tener acceso a la documentación de la función podemos usar alguna de las siguientes líneas de código:

```{r, eval=FALSE}
help(log)
?log
```

En el caso particular de RStudio, existe un atajo con el que podemos abrir la documentación de cualquier función sin necesidad de correr alguna de las líneas anteriores en la consola.

El atajo consiste de colocar el cursor de texto entre cualesquiera caracteres de la función y presionar el botón F1 de nuestro teclado.

Adicionalmente tenemos las siguientes funciones:

```{r, eval=FALSE}
apropos("plot")
help.search("plot")
```

`apropos()` nos ayudará a encontrar las funciones que incluyan el texto (en este caso _plot_) en su nombre.

Por otro lado, `help.search()` nos mostrará la documentación de las funciones que incluyan el texto, en este caso _plot_.

Como se indica, cualquiera de esas opciones te permitirá tener acceso a la documentación de la funciones donde podrás encontrar: para qué se usan, qué argumentos necesitan, lo que regresan y algunos ejemplos del uso de las mismas.

Una buena parte de los errores que podamos encontrarnos en nuestros flujos de trabajo se resolverán al revisar la documentación de la función que esté generando el error, sin embargo habrá ocasiones en las que los errores sean más complejos y la documentación no nos dará una buena pista de cómo remediarlos, en tal caso la mejor estrategía sera utilizar tu buscador favorito para buscar el error.

Será tan fácil cómo copiar el error que la consola esté arrojando y ponerlo en la barra de búsqueda de e.g. [Google][google].

## Vectores

Quizá ya hayas escuchado lo siguiente en algún lado: _R es un lenguaje vectorial_. 

El comportamiento al que hace referencia esta frase será de mucha ayuda en la construcción de rutinas avanzadas de programación que veremos más adelante, por ahora la implicación más relevante reside en el hecho de que la estructura básica en R serán justamente vectores.

Los siguientes ejemplos nos muestran cómo crear vectores numéricos en R:

```{r}
roma <- c(0.1, 0.2, 0.3)

assign("mora", c(0.4, 0.5, 0.6))

c(0.7, 0.8, 0.9) -> z

mora <- c(roma, 0, 0, 0, roma)
```

N.B. Los vectores en R no solo pueden ser numéricos también los hay aquellos con cadenas de texto.

En seguida vemos algunos ejemplos que nos permitirán acceder a elementos de un vector:

```{r}
mora[3]
```

```{r}
mora[-3]
```

```{r}
mora[c(1,5,7)]
```

### Arítmetica de vectores

El siguiente ejemplo muestra el comportamiento asociado a un lenguaje _vectorial_ que mencionabamos anteriormente:

```{r}
v <- 2*roma+mora+1

v
```

Existen una enorme cantidad de funciones para manipular los _datos_ dentro de nuestros vectores, enseguida se muestran algunas:

```{r, eval=FALSE}
sum(v) ## suma todos los elementos del objeto

prod(v) ## multiplica todos los elementos del objeto

max(v) ## encuentra el valor máximo

min(v) ## encuentra el valor mínimo

which.max(v) ## índice o posición del máximo

which.min(v) ## índice o posición del mínimo

range(v) ## vector de dos entradas con el mínimo y máximo respectivamente
```

## El ambiente (environment).

Los objetos que guardemos o asignemos en nuestros flujos de trabajo serán almacenados en un espacio de memoria que se llama _ambiente_ o en inglés _environment_. Desde RStudio podremos ver lo que se guardado en este espacio de memoria en el panel _Environment_.

Adicional a ello, existen algunas funciones que nos permiten _explorar_ nuestro ambiente:

```{r, eval=FALSE}
## Muestra los nombres de los objetos en memoria
ls()

## Muestra las variables con cierta serie de caracteres en su nombre
ls(pat="m")

## Muestra las variables las cuales su nombre empieza con el caracter dado
ls(pat="^m")

## Muestra detalles de los objetos en memoria
ls.str()

## Eliminar todas las variables de 'Global Environment'
rm(list=ls())

## Eliminar únicamente variables que empiezan con la letra m
rm(list=ls(pat="^m"))

## Tipo de elementos del objeto v
mode(v)
## Longitud del objeto v
length(v)
```

## Lectura y escritura de archivos

En cuanto a archivos externos, a lo largo del libro únicamente usaremos archivos con extensiones .csv y .txt sin embargo R no está limitado a este tipo de archivos, existen una amplia variedad de formatos que se pueden leer a través de paquetes diseñados específicamente para ese fin.

El siguiente ejemplo muestra cómo se haría la lectura de un archivo con extensión .txt:

```{r, eval=FALSE}
datos<-read.table("data.txt", # nombre del archivo (con extensión) entre comillas
                  header = TRUE, # TRUE o FALSE, indicando si el archivo tiene como primer renglón el nombre de las columnas
                  sep="\t" # separador de los campos
                  )
```

Una vez que leemos el archivo externo en R, el objeto donde se almacenará la información será de tipo `data.frame`.

Muchas veces será de nuestro interés exportar objetos `data.frame` a archivos externos, tal objetivo lo podemos lograr con alguna de las siguientes dos opciones:

```{r, eval=FALSE}
write.table(datos, "toma.txt", append=F, sep="\t")

write.csv(datos, "toma2.csv")
```

N:B. Como en la lectura de datos, R no está limitado a exportar archivos .csv o .txt también existe una amplia variedad de formatos que podemos generar.

## Algunas funciones variadas

A continuación se muestra un conjunto bastante pequeño de funciones que nos ayudarán a alcanzar distintos objetivos:

```{r, eval=FALSE}
## Generar un vector con valores subsecuentes
x <- 1:30

## Generar un vector con cierta secuencia
y <- seq(1, 5, 0.5)

w <- seq(10, 0, -0.5)

## Genera un vector que repite un dato cierto número de veces
z <- rep(1, 20)

## Genera un vector con series valores subsecuentes hasta los números indicados
q <- sequence(3:5)
q <- sequence(c(10, 5))

## Genera series regulares de factores dados. 
q <- gl(3, 5, length = 30)
q <- gl(2, 6, label = c("Hombre","Mujer"))

## A diferencia de los anteriores, la siguiente función genera un data frame con todas las
## posible combinaciones de vectores o factores dados como argumentos
q <- expand.grid(h = c(60, 80), w = c(100, 300), sex = c("Hombre", "Mujer"))
```

## Objetos

Los ejemplos anteriores consisten en el uso de funciones, dichas funciones generan cierto tipo de objetos para regresar el resultado.

Si queremos crear de manera _manual_ cierto tipo de objetos, podemos hacerlo de la siguiente manera:

### Vectores

```{r, eval=FALSE}
## Vector (numeric, logical, character)
a <- vector(mode= "logical", length=5)

b <- logical(length=5)
```

### Factores

```{r, eval=FALSE}
a <- factor(1:3, labels = c("Hola", "Adios", "Ah"))

b<- factor(x = c(2, 5), levels = 2:5)

c <- factor(1:5, exclude = 4)
```


### Matrices

```{r, eval=FALSE}
a <- matrix(1:6, 2, 3, byrow = F)

## Otra forma de crear una matriz

b <- 1:15

dim(b) <- c(5,3)
```

### Data Frames

```{r, eval=FALSE}
x <- 1:4

n <- 10

M <- c(10, 35)

a <- data.frame(x, n, M)
```

### Listas

```{r, eval=FALSE}
a <- list(x, M)

b <- list(A = x, B = M)
```

### Expresiones

```{r, eval=FALSE}
x <- 3
y <- 2.5
z <- 1

exp <- expression(x/(y + exp(z)))
```

## Algunos ejemplos más avanzados

### Operadores

|      Aritméticos      |       Comparación      |    Lógicos    |
|:---------------------:|:----------------------:|:-------------:|
|        Suma (+)       |      Menor que (<)     |    NOT (!)    |
|       Resta (-)       |      Mayor que (>)     |    AND (&)    |
|   Multiplicación (*)  | Menor o igual que (<=) |    OR (\|)    |
|      División (/)     | Mayor o igual que (>=) | Cierto (TRUE) |
|      Potencia (^)     |       Igual (==)       | Falso (FALSE) |
|      Modulo (%%)      |     Diferente (!=)     |               |
| División entera (%/%) |                        |               |

### Ciclos, condiciones y funciones

Al ser R un lenguaje de programación podemos usar:

- ciclos

```{r, eval=FALSE}
## Ciclo for
for (anio in c(2000,2001,2002,2003,2004,2005,2006,2007)){
  print(paste("Cuenta",anio))
}

## Ciclo while
i <- 1

while(i < 10){
  print(i)
  i <- i+1
}
```

- condiciones

```{r, eval=FALSE}
for (i in 1:10){
  ## Condición if
  if(!i %% 2){
    next
  } 
  print(i)
}
```

Particularmente en la programación con R, será de mucha utilidad aprender a crear funciones:

```{r, eval=FALSE}
funcionfactorial<-function(a){
  res <- 1
  if(a<0){
    return("No existen factoriales de números negativos.")
  } else if(a==0){
    return(res)
  } else{
    for(i in 1:a){
      res <- res*i
    }
    return(res)
  }
}
```

## Paquetes

En R llamamos librerías o paquetes a conjuntos de funciones diseñados para un fin específico. Por ejemplo el paquete [ggplot2][ggplot2-github] contiene funciones diseñadas para crear gráficos usando una sintáxis llamada _la gramática de gráficas_.

Para descargar alguna librería de nuestra interés debemos utilizar el siguiente código:

```{r, eval=FALSE}
install.packages("ggplot2") # Dentro de las comillas ponemos el nombre del paquete que queremos instalar
```

Dado que se trata de una instalación, el código anterior solamente será necesario la primera vez que instalemos el paquete.

Una vez instalado, necesitamos hacer que R sepa que queremos usar la funciones de ese paquete, para lo cual usamos el siguiente código:

```{r, eval=FALSE}
library(ggplot2) # El argumento de la función será el nombre del paquete previamente instalado
```

